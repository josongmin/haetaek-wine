# 서버 통합 실행 가이드

## 개요
노드 서버에서 프론트엔드와 백엔드를 모두 서빙하도록 설정되었습니다.
`connect-history-api-fallback` 미들웨어를 사용하여 안정적인 SPA 라우팅을 지원합니다.

## 실행 방법

### 1. 프로덕션 모드 (통합 실행)
```bash
npm start
```
- 프론트엔드를 빌드하고 서버 시작
- 브라우저에서 `http://localhost:4000` 접속

### 2. 빌드 없이 서버만 실행
```bash
npm run serve
```
- 이미 빌드된 프론트엔드가 있을 때 사용
- 서버만 재시작할 때 빠름

### 3. 개발 모드 (분리 실행)
```bash
npm run dev
```
- 프론트엔드 개발 서버(3000)와 백엔드 서버(4000) 동시 실행
- HMR(Hot Module Replacement) 지원

## 라우팅 구조

### connect-history-api-fallback 사용
업계 표준 미들웨어로 SPA 라우팅을 안전하게 처리합니다.

**처리 순서:**
1. API 라우트 처리 (/wine, /point, /user, /shop, /push, /external_wine_search, /crawl)
2. History API Fallback: HTML 요청을 index.html로 리다이렉트 (API는 제외)
3. 정적 파일 서빙 (JS, CSS, 이미지 등)

**장점:**
- API 요청과 프론트엔드 라우팅 충돌 방지
- Accept 헤더 기반 자동 판단
- 업계에서 검증된 안정적인 방식

### API 엔드포인트
- `/wine/*` - 와인 관련 API
- `/point/*` - 포인트 관련 API
- `/user/*` - 사용자 관련 API
- `/shop/*` - 상점 관련 API
- `/push/*` - 푸시 알림 API
- `/external_wine_search/*` - 외부 와인 검색 API
- `/crawl` - 크롤링 서비스 (nginx proxy)

## 배포
```bash
npm run deploy
```
- 프론트엔드 빌드 후 PM2로 서버 재시작

